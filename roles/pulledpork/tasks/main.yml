---
- name: Install pulledpork dependancies
  package:
    name: "{{ item }}"
    state: present
  with_items:
    - perl
    - perl-archive-tar
    - cron
    - perl-lwp-protocol-https
    - perl-crypt-ssleay
    - perl-switch
  tags: [ "pulledpork" ]

- name: Install pulledpork dependencies from aur
  yaourt:
    name: perl-bytes-random-secure
    user: "{{ ansible_user }}"
  tags: [ "pulledpork" ]

- name: Download pulledpork from github
  git:
    repo: "https://github.com/shirkdog/pulledpork.git"
    dest: "{{ pulledpork.src_dir}}/pulledpork-{{ pulledpork.version }}"
    version: "{{ pulledpork.version }}"
  tags: [ "pulledpork" ]

#execute 'Configure PulledPork' do
#  cwd "#{SRC_PATH}/pulledpork-#{PP_BRANCH}"
#  command <<-EOF
#    cp pulledpork.pl /usr/local/bin
#    chmod +x /usr/local/bin/pulledpork.pl
#    cp etc/*.conf /etc/snort
#  EOF
#  creates '/usr/local/bin/pulledpork.pl'
#  action :run
#end
#
#template '/etc/snort/pulledpork.conf' do
#  source 'pulledpork.conf.erb'
#  owner 'snort'
#  group 'snort'
#  mode '0644'
#  variables(
#    oinkcode: OINKCODE
#  )
#  notifies :run, 'execute[update-rules]', :immediate
#end
#
#execute 'update-rules' do
#  command '/usr/local/bin/pulledpork.pl -c /etc/snort/pulledpork.conf -l'
#  action :nothing
#  notifies :restart, 'service[snort]', :immediate
#end
#
#cron 'update-rules' do
#  hour '5'
#  minute '0'
#  command '/usr/local/bin/pulledpork.pl -c /etc/snort/pulledpork.conf -l'
#end
#
